---
import { getCollection, render } from "astro:content";
import MainLayout from "../../layouts/main.astro";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post) => ({
    params: { slug: post.id },
    props: { post },
  }));
}

const { post } = Astro.props;
const { Content } = await render(post);
const { title, description, category, tags, date, result, emoji, link } = post.data;
const base = import.meta.env.BASE_URL;

const categoryLabels: Record<string, string> = {
  hackathon: "Hackathon",
  award: "Award",
  talk: "Talk",
  publication: "Publication",
};

const formattedDate = date.toLocaleDateString("en-US", {
  month: "long",
  day: "numeric",
  year: "numeric",
});
---

<MainLayout title={`${title} | Said Azizov`}>
  <article class="min-h-screen bg-[#0e0e0e] text-[#e8e0d8]">
    {/* Nav */}
    <nav class="sticky top-0 z-50 bg-[#0e0e0e]/80 backdrop-blur-md border-b border-white/5">
      <div class="max-w-4xl mx-auto px-6 py-4 flex items-center justify-between">
        <a
          href={`${base}blog`}
          class="text-stone-400 hover:text-stone-200 transition-colors text-sm font-sans uppercase tracking-[0.15em]"
        >
          &larr; All posts
        </a>
        {link && (
          <a
            href={link}
            target="_blank"
            rel="noopener noreferrer"
            class="text-[#c9a87c] hover:text-[#e0c090] transition-colors text-sm font-sans"
          >
            Source &rarr;
          </a>
        )}
      </div>
    </nav>

    {/* Header */}
    <header class="max-w-4xl mx-auto px-6 pt-16 pb-12">
      <div class="flex items-center gap-3 mb-6">
        {emoji && <span class="text-3xl">{emoji}</span>}
        <span class="px-3 py-1 text-xs font-sans uppercase tracking-wider text-[#c9a87c] border border-[#c9a87c]/30 rounded-full">
          {categoryLabels[category]}
        </span>
        <span class="text-sm text-stone-500 font-sans">{formattedDate}</span>
      </div>

      <h1 class="font-serif font-bold text-4xl md:text-5xl text-stone-100 mb-4">
        {title}
      </h1>

      <p class="text-lg text-stone-400 mb-6 font-sans">{description}</p>

      {result && (
        <p class="text-[#c9a87c] font-sans font-medium mb-6">{result}</p>
      )}

      <div class="flex flex-wrap gap-2">
        {tags.map((tag) => (
          <span class="px-3 py-1 text-xs font-sans uppercase tracking-wider text-stone-500 border border-white/10 rounded-full">
            {tag}
          </span>
        ))}
      </div>
    </header>

    {/* Markdown Content */}
    <div class="max-w-4xl mx-auto px-6 pb-24">
      <div class="prose-custom">
        <Content />
      </div>
    </div>
  </article>
</MainLayout>
